## MODIFIED Requirements

### Requirement: 票種選擇功能（透過 DOM 操作）
系統 SHALL 根據優先順序自動選擇票種並透過 DOM 操作完成選擇。系統需**先排除**名稱（label text）含有「愛心」或「敬老」的票種，再從其餘票種中依下列優先順序選擇：若 popup 票種輸入框有值（trim 後非空），則優先選擇票種名稱**含有**該關鍵字的票種（取第一個符合者）；若無輸入、無符合者或關鍵字為空，則依序選擇名稱含有「全票」的票種；若無則選擇名稱含有「單人套票」的票種；若再無則選擇剩餘票種中的第一個。選取票種後，系統需在該票種後方 class 為 "bctn_i" 的元素中，找到包含 `quantityadd({索引})` 的連結並點擊，其中索引對應到該票種在 TicketInfo 中的位置（從 0 開始遞增）。

#### Scenario: 先排除愛心／敬老後再選擇
- **WHEN** 系統已解析出所有票種資料
- **THEN** 系統先排除票種名稱（label text）含有「愛心」或「敬老」的票種
- **AND** 後續關鍵字、全票、單人套票、第一個等優先順序僅在剩餘票種中套用

#### Scenario: 有輸入關鍵字且存在符合的票種
- **WHEN** 系統已解析出所有票種資料（且已排除愛心／敬老）
- **AND** popup 票種輸入框有值（trim 後非空）
- **AND** 剩餘票種中存在名稱（label text）含有該關鍵字的票種
- **THEN** 系統選擇第一個名稱含有該關鍵字的票種
- **AND** 系統定位該票種後方 class 為 "bctn_i" 的元素
- **AND** 系統在 bctn_i 元素中，找到包含 `quantityadd({索引})` 的連結（索引對應到該票種的位置，從 0 開始）
- **AND** 系統點擊該連結，觸發票種數量增加

#### Scenario: 無輸入或無符合關鍵字時選擇全票
- **WHEN** 系統已解析出所有票種資料（且已排除愛心／敬老）
- **AND** （popup 票種輸入框為空或 trim 後為空，或剩餘票種中不存在名稱含有該關鍵字的票種）
- **AND** 剩餘票種中存在名稱（label text）含有「全票」的票種
- **THEN** 系統選擇名稱含有「全票」的票種（取第一個符合者）
- **AND** 系統定位該票種後方 class 為 "bctn_i" 的元素
- **AND** 系統在 bctn_i 元素中，找到包含 `quantityadd({索引})` 的連結（索引對應到該票種的位置，從 0 開始）
- **AND** 系統點擊該連結，觸發票種數量增加

#### Scenario: 無全票時選擇單人套票
- **WHEN** 系統已解析出所有票種資料（且已排除愛心／敬老）
- **AND** 依關鍵字與「全票」順序後仍無選定票種（無輸入／無符合關鍵字且無全票）
- **AND** 剩餘票種中存在名稱（label text）含有「單人套票」的票種
- **THEN** 系統選擇名稱含有「單人套票」的票種（取第一個符合者）
- **AND** 系統定位該票種後方 class 為 "bctn_i" 的元素
- **AND** 系統在 bctn_i 元素中，找到包含 `quantityadd({索引})` 的連結（索引對應到該票種的位置，從 0 開始）
- **AND** 系統點擊該連結，觸發票種數量增加

#### Scenario: 選擇第一個票種（無關鍵字符合、全票、單人套票時）
- **WHEN** 系統已解析出所有票種資料（且已排除愛心／敬老）
- **AND** 依關鍵字、「全票」、「單人套票」順序後仍無選定票種
- **THEN** 系統選擇剩餘票種中的第一個票種（其索引對應 DOM 位置）
- **AND** 系統定位該票種後方 class 為 "bctn_i" 的元素
- **AND** 系統在 bctn_i 元素中，找到包含 `quantityadd(0)` 的連結
- **AND** 系統點擊該連結，觸發票種數量增加

#### Scenario: 無法找到票種資料
- **WHEN** 新開的 tab 頁面載入完成
- **AND** 頁面 DOM 中找不到 id 為 "TicketInfo" 的元素
- **OR** TicketInfo 中找不到 class 為 "bps_content_tickettypes_numberofsheets" 的票種元素
- **THEN** 系統在 API 狀態顯示區域顯示錯誤訊息："無法找到票種資料"
- **AND** 系統不執行後續操作

#### Scenario: 無法找到票種操作元素
- **WHEN** 系統已選取票種
- **AND** 該票種後方找不到 class 為 "bctn_i" 的元素
- **OR** bctn_i 元素中找不到包含 `quantityadd({索引})` 的連結
- **THEN** 系統在 API 狀態顯示區域顯示錯誤訊息："無法找到票種操作元素"
- **AND** 系統不執行後續操作

#### Scenario: 依優先順序仍無可用票種
- **WHEN** 系統已解析出所有票種資料（且已排除愛心／敬老）
- **AND** 依關鍵字（若有）、「全票」、「單人套票」及第一個票種之順序仍無法選定（例如排除後剩餘列表為空或無符合者）
- **THEN** 系統在 API 狀態顯示區域顯示錯誤訊息（如「無法找到可用票種」）
- **AND** 系統不執行後續票種 DOM 操作與確認按鈕點擊
